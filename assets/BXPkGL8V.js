import{_ as P,r as v,o as E,x as b,z as a,L as R,B as o,D as _,C as n,R as $,O as S,T as g,g as i,y as p,P as q,V as Y,A as D,U as V,N as J}from"./5t9ocXzk.js";const K={class:"container"},z=["disabled"],G={key:0,class:"dialog-content"},X=["src"],H=["src"],Q={style:{"text-align":"right","margin-top":"10px"}},W={id:"loader"},k="https://script.google.com/macros/s/AKfycbyhV4INreTg9NfkTp3U72jtYXp8qIxCDiCbAKpsc-1222p67Foqe6isCxU7PYvTfebi5A/exec",Z={__name:"index",setup(ee){const h=v([]),x=v(!1),y=v(!1),r=v(null),u=v(!1),t=v({type:"",date:"",title:"",imageUrl:"",content:""});function M(s){const e=new Date(s);return isNaN(e)?s:new Date(e.getTime()+8*60*60*1e3).toISOString().split("T")[0]}function C(){u.value=!0,fetch(k).then(s=>s.json()).then(s=>{h.value=s.filter(e=>e.date).map(e=>({...e,date:M(e.date)})).sort((e,c)=>new Date(c.date)-new Date(e.date))}).catch(()=>g.error("載入失敗")).finally(()=>u.value=!1)}function A(s){r.value=s,x.value=!0}function B(){y.value=!0,t.value={type:"",date:"",title:"",content:"",imageUrl:""}}function L(){if(!t.value.type||!t.value.date||!t.value.content){g.warning("請填寫所有欄位");return}u.value=!0;const s={...t.value,date:t.value.date,id:Date.now(),imageUrl:t.value.imageUrl||""};fetch(k,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(s),redirect:"follow"}).then(e=>e.json()).then(e=>{if(e.success)g.success("新增成功"),y.value=!1,C();else throw new Error}).catch(()=>g.error("新增失敗")).finally(()=>u.value=!1)}async function O(s){const e=s.file,c=await new Promise(d=>{const f=new FileReader;f.onload=m=>{const U=m.target.result.split(",")[1];d(U)},f.readAsDataURL(e)});u.value=!0;try{const d={action:"upload",file:c,filename:e.name,mimeType:e.type},m=await(await fetch(k,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(d)})).json();if(m.url)t.value.imageUrl=m.url,g.success("圖片上傳成功");else throw new Error("上傳失敗")}catch(d){console.error("上傳錯誤:",d),g.error("圖片上傳失敗")}finally{u.value=!1}}return E(C),(s,e)=>{const c=i("el-timeline-item"),d=i("el-timeline"),f=i("el-dialog"),m=i("el-radio"),U=i("el-radio-group"),w=i("el-form-item"),j=i("el-date-picker"),T=i("el-input"),F=i("el-upload"),N=i("el-button"),I=i("el-form");return p(),b(S,null,[a("div",K,[a("button",{class:"back-btn",onClick:e[0]||(e[0]=l=>s.$router.push("/"))},e[8]||(e[8]=[a("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-chevron-compact-left",viewBox:"0 0 16 16"},[a("path",{"fill-rule":"evenodd",d:"M9.224 1.553a.5.5 0 0 1 .223.67L6.56 8l2.888 5.776a.5.5 0 1 1-.894.448l-3-6a.5.5 0 0 1 0-.448l3-6a.5.5 0 0 1 .67-.223"})],-1),_(" 返回 ")])),e[16]||(e[16]=a("h1",null,"約會日記",-1)),a("button",{class:"add-btn",onClick:B,disabled:u.value},"新增",8,z),o(d,{class:"timeline-box"},{default:n(()=>[(p(!0),b(S,null,q(h.value,l=>(p(),Y(c,{key:l.id,timestamp:l.date,color:l.type==="紀念日"?"#86b1a3":"#ccc",onClick:te=>A(l),class:"timeline-item"},{default:n(()=>[_(D(l.title),1)]),_:2},1032,["timestamp","color","onClick"]))),128))]),_:1}),o(f,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=l=>x.value=l),title:r.value?r.value.title:"no data",width:"90%"},{default:n(()=>[r.value?(p(),b("div",G,[a("p",null,[e[9]||(e[9]=a("strong",null,"日期：",-1)),a("span",null,D(r.value.date),1)]),a("p",null,[e[10]||(e[10]=a("strong",null,"內容：",-1)),a("span",null,D(r.value.content),1)]),r.value.imageUrl?(p(),b("img",{key:0,src:r.value.imageUrl,alt:"image",style:{"max-width":"50%",margin:"16px 25%"}},null,8,X)):V("",!0)])):V("",!0)]),_:1},8,["modelValue","title"]),o(f,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),title:"新增紀錄",width:"90%"},{default:n(()=>[o(I,{onSubmit:J(L,["prevent"]),"label-width":"80px"},{default:n(()=>[o(w,{label:"種類"},{default:n(()=>[o(U,{modelValue:t.value.type,"onUpdate:modelValue":e[2]||(e[2]=l=>t.value.type=l)},{default:n(()=>[o(m,{value:"紀念日"},{default:n(()=>e[11]||(e[11]=[_("紀念日")])),_:1,__:[11]}),o(m,{value:"約會"},{default:n(()=>e[12]||(e[12]=[_("約會")])),_:1,__:[12]})]),_:1},8,["modelValue"])]),_:1}),o(w,{label:"日期"},{default:n(()=>[o(j,{modelValue:t.value.date,"onUpdate:modelValue":e[3]||(e[3]=l=>t.value.date=l),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),o(w,{label:"標題"},{default:n(()=>[o(T,{modelValue:t.value.title,"onUpdate:modelValue":e[4]||(e[4]=l=>t.value.title=l),placeholder:"請輸入"},null,8,["modelValue"])]),_:1}),o(w,{label:"內容"},{default:n(()=>[o(T,{modelValue:t.value.content,"onUpdate:modelValue":e[5]||(e[5]=l=>t.value.content=l),type:"textarea",placeholder:"請輸入日記內容"},null,8,["modelValue"])]),_:1}),o(w,{label:"上傳圖片"},{default:n(()=>[t.value.imageUrl?V("",!0):(p(),Y(F,{key:0,class:"upload-demo",drag:"","http-request":O,"show-file-list":!1},{default:n(()=>e[13]||(e[13]=[a("i",{class:"el-icon-upload"},null,-1),a("div",{class:"el-upload__text"},[a("em",null,"點此上傳")],-1)])),_:1,__:[13]})),t.value.imageUrl?(p(),b("img",{key:1,src:t.value.imageUrl,style:{"margin-top":"10px","max-width":"80%"}},null,8,H)):V("",!0)]),_:1}),a("div",Q,[o(N,{onClick:e[6]||(e[6]=l=>y.value=!1)},{default:n(()=>e[14]||(e[14]=[_("取消")])),_:1,__:[14]}),o(N,{type:"primary","native-type":"submit",loading:u.value},{default:n(()=>e[15]||(e[15]=[_("送出")])),_:1,__:[15]},8,["loading"])])]),_:1})]),_:1},8,["modelValue"])]),R(a("div",W,e[17]||(e[17]=[a("span",{class:"loader-icon"},null,-1),a("span",{style:{"margin-left":"8px",color:"#252c74"}},"載入中...",-1)]),512),[[$,u.value]])],64)}}},ae=P(Z,[["__scopeId","data-v-1c516695"]]);export{ae as default};
