import{_ as K}from"./Dzuhxpy8.js";import{_ as R}from"./CJ6Y9Xac.js";import{_ as z}from"./B9Z690m9.js";import{_ as J,r as _,o as $,x as b,B as t,C as o,L as Y,T as f,g as i,y as c,z as s,M as G,K as B,D as v,A as h,U as V,Q}from"./f75ejVAB.js";const X=["disabled"],W={key:0,class:"dialog-content"},Z=["src"],ee=["src"],te={style:{"text-align":"right","margin-top":"10px"}},D="https://script.google.com/macros/s/AKfycbyhV4INreTg9NfkTp3U72jtYXp8qIxCDiCbAKpsc-1222p67Foqe6isCxU7PYvTfebi5A/exec",le={__name:"index",setup(ae){const k=_([]),U=_(!1),g=_(!1),r=_(null),u=_(!1),l=_({type:"",date:"",title:"",imageUrl:"",content:""});function T(){l.value={type:"",date:"",title:"",content:"",imageUrl:""}}function S(n){const e=new Date(n);return isNaN(e)?n:new Date(e.getTime()+8*60*60*1e3).toISOString().split("T")[0]}function M(){u.value=!0,T(),fetch(D).then(n=>n.json()).then(n=>{k.value=n.filter(e=>e.date).map(e=>({...e,date:S(e.date)})).sort((e,p)=>new Date(p.date)-new Date(e.date))}).catch(()=>f.error("載入失敗")).finally(()=>u.value=!1)}function L(n){r.value=n,U.value=!0}function A(){g.value=!0}function F(){if(!l.value.type||!l.value.date||!l.value.content){f.warning("請填寫所有欄位");return}u.value=!0;const n={...l.value,date:l.value.date,id:Date.now(),imageUrl:l.value.imageUrl||""};fetch(D,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(n),redirect:"follow"}).then(e=>e.json()).then(e=>{if(e.success)f.success("新增成功"),g.value=!1,M();else throw new Error}).catch(()=>f.error("新增失敗")).finally(()=>u.value=!1)}async function j(n){const e=n.file,p=await new Promise(d=>{const y=new FileReader;y.onload=m=>{const x=m.target.result.split(",")[1];d(x)},y.readAsDataURL(e)});u.value=!0;try{const d={action:"upload",file:p,filename:e.name,mimeType:e.type},m=await(await fetch(D,{method:"POST",headers:{"Content-Type":"text/plain;charset=utf-8"},body:JSON.stringify(d)})).json();if(m.url)l.value.imageUrl=m.url,f.success("圖片上傳成功");else throw new Error("上傳失敗")}catch(d){console.error("上傳錯誤:",d),f.error("圖片上傳失敗")}finally{u.value=!1}}return $(M),(n,e)=>{const p=K,d=i("el-timeline-item"),y=i("el-timeline"),m=i("el-dialog"),x=i("el-radio"),I=i("el-radio-group"),w=i("el-form-item"),O=i("el-date-picker"),N=i("el-input"),P=i("el-upload"),C=i("el-button"),E=i("el-form"),H=R,q=z;return c(),b(Y,null,[t(H,{color1:"#e6fcee",color2:"#cef6df"},{default:o(()=>[t(p,{title:"約會日記","page-color":"dating-diary"}),s("button",{class:"add-btn",onClick:A,disabled:u.value},"新增",8,X),t(y,{class:"timeline-box"},{default:o(()=>[(c(!0),b(Y,null,G(k.value,a=>(c(),B(d,{key:a.id,timestamp:a.date,color:a.type==="紀念日"?"#86b1a3":"#ccc",onClick:oe=>L(a),class:"timeline-item"},{default:o(()=>[v(h(a.title),1)]),_:2},1032,["timestamp","color","onClick"]))),128))]),_:1}),t(m,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),title:r.value?r.value.title:"no data",width:"90%"},{default:o(()=>[r.value?(c(),b("div",W,[s("p",null,[e[7]||(e[7]=s("strong",null,"日期：",-1)),s("span",null,h(r.value.date),1)]),s("p",null,[e[8]||(e[8]=s("strong",null,"內容：",-1)),s("span",null,h(r.value.content),1)]),r.value.imageUrl?(c(),b("img",{key:0,src:r.value.imageUrl,alt:"image",style:{"max-width":"50%",margin:"16px 25%"}},null,8,Z)):V("",!0)])):V("",!0)]),_:1},8,["modelValue","title"]),t(m,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),title:"新增紀錄",width:"90%"},{default:o(()=>[t(E,{onSubmit:Q(F,["prevent"]),"label-width":"80px"},{default:o(()=>[t(w,{label:"種類"},{default:o(()=>[t(I,{modelValue:l.value.type,"onUpdate:modelValue":e[1]||(e[1]=a=>l.value.type=a)},{default:o(()=>[t(x,{value:"紀念日"},{default:o(()=>e[9]||(e[9]=[v("紀念日")])),_:1,__:[9]}),t(x,{value:"約會"},{default:o(()=>e[10]||(e[10]=[v("約會")])),_:1,__:[10]})]),_:1},8,["modelValue"])]),_:1}),t(w,{label:"日期"},{default:o(()=>[t(O,{modelValue:l.value.date,"onUpdate:modelValue":e[2]||(e[2]=a=>l.value.date=a),type:"date",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",placeholder:"請選擇日期"},null,8,["modelValue"])]),_:1}),t(w,{label:"標題"},{default:o(()=>[t(N,{modelValue:l.value.title,"onUpdate:modelValue":e[3]||(e[3]=a=>l.value.title=a),placeholder:"請輸入"},null,8,["modelValue"])]),_:1}),t(w,{label:"內容"},{default:o(()=>[t(N,{modelValue:l.value.content,"onUpdate:modelValue":e[4]||(e[4]=a=>l.value.content=a),type:"textarea",placeholder:"請輸入日記內容"},null,8,["modelValue"])]),_:1}),t(w,{label:"上傳圖片"},{default:o(()=>[l.value.imageUrl?V("",!0):(c(),B(P,{key:0,class:"upload-demo",drag:"","http-request":j,"show-file-list":!1,style:{width:"16em"}},{default:o(()=>e[11]||(e[11]=[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",fill:"currentColor",class:"bi bi-cloud-upload",viewBox:"0 0 16 16"},[s("path",{"fill-rule":"evenodd",d:"M4.406 1.342A5.53 5.53 0 0 1 8 0c2.69 0 4.923 2 5.166 4.579C14.758 4.804 16 6.137 16 7.773 16 9.569 14.502 11 12.687 11H10a.5.5 0 0 1 0-1h2.688C13.979 10 15 8.988 15 7.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 2.825 10.328 1 8 1a4.53 4.53 0 0 0-2.941 1.1c-.757.652-1.153 1.438-1.153 2.055v.448l-.445.049C2.064 4.805 1 5.952 1 7.318 1 8.785 2.23 10 3.781 10H6a.5.5 0 0 1 0 1H3.781C1.708 11 0 9.366 0 7.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383"}),s("path",{"fill-rule":"evenodd",d:"M7.646 4.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 5.707V14.5a.5.5 0 0 1-1 0V5.707L5.354 7.854a.5.5 0 1 1-.708-.708z"})],-1),s("div",{class:"el-upload__text"},[s("em",{style:{color:"#666"}},"點此選擇圖片")],-1)])),_:1,__:[11]})),l.value.imageUrl?(c(),b("img",{key:1,src:l.value.imageUrl,style:{"margin-top":"10px","max-width":"80%"}},null,8,ee)):V("",!0)]),_:1}),s("div",te,[t(C,{onClick:T},{default:o(()=>e[12]||(e[12]=[v("清空")])),_:1,__:[12]}),t(C,{onClick:e[5]||(e[5]=a=>g.value=!1)},{default:o(()=>e[13]||(e[13]=[v("取消")])),_:1,__:[13]}),t(C,{type:"primary","native-type":"submit",loading:u.value},{default:o(()=>e[14]||(e[14]=[v("送出")])),_:1,__:[14]},8,["loading"])])]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(q,{visible:u.value,color:"#257436"},null,8,["visible"])],64)}}},re=J(le,[["__scopeId","data-v-c9c04c08"]]);export{re as default};
